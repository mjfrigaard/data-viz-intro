<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introduction to Data Visualization with ggplot2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Martin Frigaard" />
    <meta name="date" content="2020-11-22" />
    <script src="Index_files/header-attrs-2.5.3/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introduction to Data Visualization with ggplot2
## BioMarin Meetup: Introduction to the grammar of graphics
### Martin Frigaard
### 2020-11-22

---






&lt;img src="img/ggplot2_masterpiece.png" width="90%" height="90%" style="display: block; margin: auto;" /&gt;

.pull-right[Art by Allison Horst]

---
class: inverse, center
background-image: url(img/ggplot2.png)
background-position: 50% 70%
background-size: 30%

# Data Visualization with R with `ggplot2`

---
class: left, top
background-image: url(img/ggplot2.png)
background-position: 90% 7%
background-size: 8%

# Objectives

### 1) Introduce to the grammar of graphics

### 2) Identify graph aesthetics 

### 3) Recognize `geoms` 

### 4) Understand theme elements 

---
class: left, top
background-image: url(img/ggplot2.png)
background-position: 90% 7%
background-size: 8%

# Resources 

### Link to these slides 

### Link to exercises 

### Link to RStudio Project 



---
class: left, top
background-image: url(img/ggplot2.png)
background-position: 90% 7%
background-size: 8%

# Why use `ggplot2` for Data Visualization?

--

### 1) `ggplot2` provides a comprehensive grammar for creating graphs/figures

--

### 2) It works hand-and-hand with the `tidyverse` 

--

### 3) Better plots are better communication



---
class: left, top
background-image: url(img/ggplot2.png)
background-position: 90% 7%
background-size: 8%

# Why Do We Create Data Visualizations? 

--

### Clarification 

&gt;  "The simple graph has brought more information to the data analyst’s mind than any other device. " - John Tukey

--

### Better decisions

&gt; "Data visualization is a collection of methods that use visual representations to explore, make sense of, and communicate quantitative data…The ultimate purpose of data visualization, beyond understanding, is to enable better decisions and actions." - Stephen Few


---
class: left, top
background-image: url(img/ggplot2.png)
background-position: 95% 7%
background-size: 8%

# How should we start creating data visualizations?

--

## Start with pen and paper

--

### *get those first bad ideas out of the way*

--

## Import and inspect your data 

--

### *so you know what to expect*

---
background-image: url(img/ggplot2.png)
background-position: 96% 8%
background-size: 8%

# Layered Grammar of Graphics

--

&gt; *"appreciating the engineering design behind a sentence – **a linear ordering of phrases which conveys a gnarly network of ideas** — is the key to understanding what you are trying to accomplish when you compose a sentence."* - Stephen Pinker

--

&gt; *"language is a system for making infinite use of finite means."* - Wilhelm von Humboldt

--

## `ggplot2` is a language of *layers*

--

 `ggplot2`'s layers give us a "*linear ordering of phrases*" to build infinite number of graphs "*which convey a gnarly network of ideas.*" 

### "Infinitely extensible"


---
background-image: url(img/ggplot2.png)
background-position: 96% 8%
background-size: 8%

# Layered Grammar of Graphics

## How it works:

--

### Variables are *mapped* to *aesthetics* 

--

### Statistics are linked to *geoms*

--

### Final touches are added with *themes*

---
background-image: url(img/ggplot2.png)
background-position: 96% 8%
background-size: 8%

# Load some data 

The `NHANES` package comes with data from the [2014 American National Health and Nutrition Examination surveys](http://www.cdc.gov/nchs/data/series/sr_02/sr02_162.pdf). We will load a sample from it below: 




```r
SmallNhanes &lt;- read_csv("https://bit.ly/nhanes-small")
SmallNhanes %&gt;% glimpse()
```

```
## Rows: 10,000
## Columns: 10
## $ ID        &lt;dbl&gt; 51624, 51624, 51624, 51625, 51630, 51638, 51646, 51647, 5164…
## $ Gender    &lt;chr&gt; "male", "male", "male", "male", "female", "male", "male", "f…
## $ Age       &lt;dbl&gt; 34, 34, 34, 4, 49, 9, 8, 45, 45, 45, 66, 58, 54, 10, 58, 50,…
## $ Race1     &lt;chr&gt; "White", "White", "White", "Other", "White", "White", "White…
## $ HealthGen &lt;chr&gt; "Good", "Good", "Good", NA, "Good", NA, NA, "Vgood", "Vgood"…
## $ Height    &lt;dbl&gt; 164.7, 164.7, 164.7, 105.4, 168.4, 133.1, 130.6, 166.7, 166.…
## $ BMI       &lt;dbl&gt; 32.22, 32.22, 32.22, 15.30, 30.57, 16.82, 20.64, 27.24, 27.2…
## $ Weight    &lt;dbl&gt; 87.4, 87.4, 87.4, 17.0, 86.7, 29.8, 35.2, 75.7, 75.7, 75.7, …
## $ Pulse     &lt;dbl&gt; 70, 70, 70, NA, 86, 82, 72, 62, 62, 62, 60, 62, 76, 80, 94, …
## $ BPSysAve  &lt;dbl&gt; 113, 113, 113, NA, 112, 86, 107, 118, 118, 118, 111, 104, 13…
```

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 8%

# Quick tips for cleaning data 

### Standardize names 


```r
SmallNhanes &lt;- SmallNhanes %&gt;% 
  janitor::clean_names()
SmallNhanes %&gt;% glimpse()
```

```
## Rows: 10,000
## Columns: 10
## $ id         &lt;dbl&gt; 51624, 51624, 51624, 51625, 51630, 51638, 51646, 51647, 516…
## $ gender     &lt;chr&gt; "male", "male", "male", "male", "female", "male", "male", "…
## $ age        &lt;dbl&gt; 34, 34, 34, 4, 49, 9, 8, 45, 45, 45, 66, 58, 54, 10, 58, 50…
## $ race1      &lt;chr&gt; "White", "White", "White", "Other", "White", "White", "Whit…
## $ health_gen &lt;chr&gt; "Good", "Good", "Good", NA, "Good", NA, NA, "Vgood", "Vgood…
## $ height     &lt;dbl&gt; 164.7, 164.7, 164.7, 105.4, 168.4, 133.1, 130.6, 166.7, 166…
## $ bmi        &lt;dbl&gt; 32.22, 32.22, 32.22, 15.30, 30.57, 16.82, 20.64, 27.24, 27.…
## $ weight     &lt;dbl&gt; 87.4, 87.4, 87.4, 17.0, 86.7, 29.8, 35.2, 75.7, 75.7, 75.7,…
## $ pulse      &lt;dbl&gt; 70, 70, 70, NA, 86, 82, 72, 62, 62, 62, 60, 62, 76, 80, 94,…
## $ bp_sys_ave &lt;dbl&gt; 113, 113, 113, NA, 112, 86, 107, 118, 118, 118, 111, 104, 1…
```

---
background-image: url(img/ggplot2.png)
background-position: 95% 20%
background-size: 8%

# Quick tips for cleaning data 

### Format factors 

We have a `health_gen` variable with the following levels: 

`Excellent`, `Vgood`, `Good`, `Fair`, or `Poor`. These are ordered. 

--


```r
SmallNhanes &lt;- 
  SmallNhanes %&gt;% mutate(
  health_gen = factor(x = health_gen, 
                       levels = c("Poor", "Fair", 
                                  "Good", "Vgood", 
                                  "Excellent"), 
                      ordered = TRUE))
```

--



```r
levels(SmallNhanes$health_gen)
```

```
## [1] "Poor"      "Fair"      "Good"      "Vgood"     "Excellent"
```

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 8%

# Your Turn

&lt;br&gt;

--

## What relationship do you expect to see between `height` and `weight`?

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 8%

## 1. Use data and pipe to initialize a graph

`SmallNhanes %&gt;%`   
`ggplot()`

--

## 2. Map variables to aesthetics 

`SmallNhanes %&gt;%`   
`ggplot(mapping = aes(x = height, y = weight))`

--

## 3. Add geoms and layers 

`SmallNhanes %&gt;% `  
    `ggplot(mapping = aes(x = height, y = weight)) +`  
    `geom_point()`

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 6%


```r
SmallNhanes %&gt;% 
* ggplot() # initialize
```

&lt;img src="img/initialize-1.png" style="display: block; margin: auto;" /&gt;

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 5%


```r
SmallNhanes %&gt;% 
* ggplot(mapping = aes(x = height, y = weight)) # map variables
```

&lt;img src="img/mapping-1.png" style="display: block; margin: auto;" /&gt;

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 6%


```r
SmallNhanes %&gt;% 
  ggplot(mapping = aes(x = height, y = weight)) + 
* geom_point() # add geoms
```

&lt;img src="img/geoms-1.png" style="display: block; margin: auto;" /&gt;

---
background-image: url(img/ggplot2.png)
background-position: 95% 7%
background-size: 8%

# `ggplot2` template


```r
&lt;DATA&gt; %&gt;% 
  ggplot(mapping = aes(&lt;MAPPINGS&gt;)) + 
  &lt;GEOM_FUNCTION&gt;()
```

#### We can add more aesthetics *inside* geoms


```r
&lt;DATA&gt; %&gt;% 
  ggplot(mapping = aes(&lt;MAPPINGS&gt;)) + 
  &lt;GEOM_FUNCTION&gt;(mapping = aes(&lt;MAPPINGS&gt;))
```

#### And we can add *more* geoms


```r
&lt;DATA&gt; %&gt;% 
  ggplot(mapping = aes(&lt;MAPPINGS&gt;)) + 
  &lt;GEOM_FUNCTION&gt;(mapping = aes(&lt;MAPPINGS&gt;)) + 
  &lt;GEOM_FUNCTION&gt;(mapping = aes(&lt;MAPPINGS&gt;))
```

---
background-image: url(img/ggplot2.png)
background-position: 95% 7%
background-size: 8%

# `ggplot2` template tips

## Note the different syntax

--

### Initializing plots


```r
*&lt;DATA&gt; %&gt;% # initialize
```

--

### Adding layers


```r
&lt;DATA&gt; %&gt;% 
* ggplot(mapping = aes(&lt;MAPPINGS&gt;)) + # adding layers
  &lt;GEOM_FUNCTION&gt;()
```


---
background-image: url(img/ggplot2.png)
background-position: 95% 7%
background-size: 8%

# Your Turn

### Move the aesthetic mappings into `geom_point()`

*From here...*


```r
SmallNhanes %&gt;% 
* ggplot(mapping = aes(x = height, y = weight)) +
  geom_point() 
```

*...to here.*

```r
SmallNhanes %&gt;% 
  ggplot() + 
* geom_point(mapping = aes(x = height, y = weight))
```

### What do you expect to see?

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 4%


```r
SmallNhanes %&gt;% 
  ggplot() + 
  geom_point(mapping = aes(x = height, y = weight))
```

&lt;img src="img/aes-in-geom-render-1.png" style="display: block; margin: auto;" /&gt;

---
background-image: url(img/ggplot2.png)
background-position: 95% 7%
background-size: 7%

# `ggplot2` template

### We can either pass the variables directly to the `ggplot()` function

&lt;img src="img/ggplot2-template-01.png" width="100%" height="100%" style="display: block; margin: auto;" /&gt;

---
background-image: url(img/ggplot2.png)
background-position: 95% 7%
background-size: 7%

# `ggplot2` template

### Or we can pass the variables into the `geom()` function

&lt;img src="img/ggplot2-template-02.png" width="100%" height="100%" style="display: block; margin: auto;" /&gt;

---
class: inverse, center
background-image: url(img/ggplot2.png)
background-position: 50% 60%
background-size: 30%

# Mappings


---
background-image: url(img/ggplot2.png)
background-position: 95% 7%
background-size: 7%

# Mappings

## Is the relationship between `weight` and `height` the same for both `gender`s?

--

### We can explore this by mapping the variable to different aesthetics

--

### Examples of aesthetics are `color`, `size`, `shape`, and `alpha`

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 4%


```r
SmallNhanes %&gt;% ggplot() + 
  geom_point(aes(x = weight, y = height, 
*                            color = gender))
```

&lt;img src="img/color-1.png" style="display: block; margin: auto;" /&gt;

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 4%


```r
SmallNhanes %&gt;% ggplot() + 
  geom_point(aes(x = weight, y = height, 
*                            size = gender))
```

&lt;img src="img/size-point-1.png" style="display: block; margin: auto;" /&gt;

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 4%


```r
SmallNhanes %&gt;% ggplot() + 
  geom_point(aes(x = weight, y = height, 
*                             shape = gender))
```

&lt;img src="img/shape-point-1.png" style="display: block; margin: auto;" /&gt;

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 4%


```r
SmallNhanes %&gt;% ggplot() + 
  geom_point(aes(x = weight, y = height, 
*                           alpha = gender))
```

&lt;img src="img/alpha-point-1.png" style="display: block; margin: auto;" /&gt;

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 4%

# Aesthetic mappings 

&lt;br&gt;

.pull-left[

### Legend is automatically included 

### Continuous variables best with `size`

]

.pull-right[

&lt;img src="img/aes-settings.png" width="100%" height="100%" style="display: block; margin: auto;" /&gt;

]

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 4%

# Setting vs. mapping variables

How can we create this plot?

&lt;br&gt;

&lt;img src="img/red-points-1.png" width="80%" height="80%" style="display: block; margin: auto;" /&gt;


---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 4%

&lt;br&gt;


```r
SmallNhanes %&gt;% ggplot() + 
  geom_point(
*   aes(x = weight, y = height, color = gender))# inside aes
```

--

&lt;br&gt;&lt;br&gt;

&lt;img src="img/color-1.png" width="80%" height="80%" style="display: block; margin: auto;" /&gt;

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 4%

&lt;br&gt;


```r
SmallNhanes %&gt;% ggplot() + 
  geom_point(
*   aes(x = weight, y = height), color = "red") # outside aes
```

--

&lt;br&gt;&lt;br&gt;

&lt;img src="img/red-points-1.png" width="80%" height="80%" style="display: block; margin: auto;" /&gt;


---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 4%

# What if we make a mistake? 


```r
SmallNhanes %&gt;% ggplot() + 
* geom_point(aes(x = weight, y = height, color = "blue")) # "" in aes
```

--

&lt;img src="img/color-outside-aes-1.png" width="80%" height="80%" style="display: block; margin: auto;" /&gt;

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 8%

# Geoms 

### These are visual geometric objects used to represent the data

### Examples include `geom_box()`, `geom_col()`, `geom_line()`, and `geom_smooth()`

### See the cheatsheet for more examples: 

https://bit.ly/ggplot2-cheat

---
background-image: url(img/ggplot2.png)
background-position: 95% 7%
background-size: 8%

# Your Turn

&lt;br&gt;

--

## What relationship do you expect to see between BMI and average systolic blood pressure?

---
background-image: url(img/ggplot2.png)
background-position: 95% 93%
background-size: 8%


```r
SmallNhanes %&gt;% 
  ggplot() + 
  geom_point(aes(x = bmi, y = bp_sys_ave))
```

&lt;img src="img/unnamed-chunk-1-1.png" style="display: block; margin: auto;" /&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
